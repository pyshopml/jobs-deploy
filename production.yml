---

- hosts: production
  vars_files:
    - group_vars/prod-vars.yml
    - group_vars/vars-vault.yml
  become: true
  roles:
    - system
    - webserver

- hosts: production
  vars_files:
    - group_vars/prod-vars.yml
    - group_vars/vars-vault.yml
  become: true
  become_user: "{{ username }}"
  roles:
    - django
    - frontend

- hosts: production
  become: true
  vars_files:
    - group_vars/prod-vars.yml
    - group_vars/vars-vault.yml
  tasks:
    - name: restart site in supervisor
      supervisorctl: name={{ project_slug }}-gunicorn state=restarted

    - name: restart postgresql
      service: name=postgresql state=restarted enabled=yes

    - name: restart nginx
      service: name=nginx state=restarted enabled=yes
